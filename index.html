<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Attendance</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<style>
body {
  font-family: Arial;
  text-align: center;
  margin-top: 80px;
}
</style>
</head>

<body>

<h2>ðŸ“Œ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
<div id="msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>

<script>
const params = new URLSearchParams(location.search);
const CODE = params.get("code");

function registerOffline(code) {
  let data = JSON.parse(localStorage.getItem("attendance015") || "[]");

  data.push({
    code: code,
    time: Date.now()
  });

  localStorage.setItem("attendance015", JSON.stringify(data));

  document.getElementById("msg").innerHTML =
    "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)";
}

registerOffline(CODE);

window.addEventListener("online", syncData);

function syncData() {
  let data = JSON.parse(localStorage.getItem("attendance015") || "[]");
  if (!data.length) return;

  fetch("https://script.google.com/macros/s/AKfycbymJve-vhr_QjeBds1aFc2nvRaWt9Khypn1hExdkm_O_xPUVqR3hCohDYUC88lWxlm3Bg/exec", {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  }).then(() => {
    localStorage.removeItem("attendance015");
  });
}
</script>

</body>
</html>
